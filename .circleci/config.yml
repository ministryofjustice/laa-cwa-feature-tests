version: 2.1

orbs:
  browser-tools: circleci/browser-tools@1.4.0

jobs:
  test:
    docker:
      - image: cimg/ruby:2.7.6-browsers
    steps:
      - checkout
      - run:
          name: Install git-crypt
          command: |
            sudo apt-get update
            sudo apt-get install git-crypt
      - run:
          name: Decrypt secrets
          command: |
            echo "${GIT_CRYPT_KEY}" | base64 -d > git-crypt.key
            git-crypt unlock git-crypt.key
      - browser-tools/install-browser-tools:
          chrome-version: 114.0.5735.90
      - run: |
          ruby --version
          node --version
          java --version
          google-chrome --version
      - run:
          name: Run bundle dependencies
          command: bundle install 
      - run:
          name: Run tests
          command: bundle exec cucumber

workflows:
  version: 2
  build_and_test:
    jobs:
      - test
